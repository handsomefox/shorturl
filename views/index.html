<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
    <title>ShortURL</title>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="#">ShortURL</a>
        </div>
    </div>
</nav>
<div class="container h-75 d-flex">
    <div class="m-auto w-50 row">
        <label class="text-white text-center" for="basic-url-roll">Link will be copied to clipboard automatically!</label>
        <div class="align-items-center input-group mb-3">
            <input id="basic-url-roll" type="url" class="form-control" placeholder="URL to get rolled">
            <div class="input-group-append">
                <button class="btn btn-success" type="submit" onclick="handleRoll()">Go!</button>
            </div>
        </div>
        <div class="align-items-center input-group mb-3">
            <label for="basic-url-unroll"></label>
            <input id="basic-url-unroll" type="url" class="form-control" placeholder="URL to get unrolled">
            <div class="input-group-append">
                <button class="btn btn-success" type="submit" onclick="handleUnroll()">Go!</button>
            </div>
        </div>
    </div>
</div>
<footer class="bg-dark text-center text-white align-bottom position-absolute bottom-0 w-100">
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
        <a class="text-white" href="https://github.com/handsomefox">2022 Â© Suicedek</a>
    </div>
</footer>
</body>
<script>
    function httpGet(theUrl) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", theUrl, false); // false for synchronous request
        xmlHttp.send(null);
        return xmlHttp.responseText;
    }

    function handleRoll() {
        const input = document.getElementById("basic-url-roll").value;
        if (isValidHttpUrl(input)) {
            const loc = window.location;
            const resp = httpGet(loc.origin + "/s/" + removeSlashes(input));
            const json = JSON.parse(resp);

            const link = json["link"];
            navigator.clipboard.writeText(link)
            alert("Copied link to clipboard! Link: " + link)
        } else {
            alert("Enter a valid http or https URL");
        }
    }

    function handleUnroll() {
        const input = document.getElementById("basic-url-unroll").value;
        if (isValidHttpUrl(input)) {
            window.location.href = handleLocalHost(input);
        } else {
            alert("Enter a valid http or https URL");
        }
    }

    function handleLocalHost(string) {
        let url;
        try {
            url = new URL(string);
        } catch (_) {
            return;
        }

        if (url.protocol === "localhost:") {
            return "http://" + string
        }
    }

    function removeSlashes(string) {
        let url;
        try {
            url = new URL(string);
        } catch (_) {
            return;
        }
        if (url.protocol === "http:") {
            return string.replace("http://", '')
        }
        if (url.protocol === "https:") {
            return string.replace("https://", '')
        }
        return string;
    }

    function isValidHttpUrl(string) {
        let url;
        try {
            url = new URL(string);
        } catch (_) {
            return false;
        }
        return url.protocol === "http:" || url.protocol === "https:" || url.protocol === "localhost:";
    }
</script>
<style>
    * {
        box-sizing: border-box;
        font-family: 'Lato', sans-serif, Arial;
    }

    body {
        background: linear-gradient(
                45deg,
                rgb(1, 0, 22) 0%,
                rgb(7, 60, 97) 50%,
                rgb(8, 149, 201) 100%
        );
    }
</style>
</html>
